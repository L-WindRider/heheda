<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="js/windrider.js"></script>
    <style>
    .clip{display: none;}
    .clip img{position:fixed;width: 100%;top: 0;left: 0;}
    .clip .clipCoverDiv{position:fixed;width: 100%;height: 100%;top: 0;left: 0;}
    .clip p{position:fixed;width: 100%;top: 0;left: 0;color: #FFF;}
    </style>
</head>
<input type="file" id="upload" accept="image/png,image/jpeg">
<div id="clip" class="clip">
    <img id="clipImg" class="clipImg" />
    <img id="clipCoverImg" class="clipCoverImg" src="images/cover.png" />
    <div id="clipCoverDiv" class="clipCoverDiv"></div>
    <p id="event"></p>
</div>
<body>
<script>
    var clip = document.getElementById("clip");//弹出框
    var upload = document.getElementById("upload");//上传图片input按钮
    var clipImg = document.getElementById("clipImg");//剪裁图片
    var clipCoverImg = document.getElementById("clipCoverImg");//剪裁遮盖
    var clipCoverDiv = document.getElementById("clipCoverDiv");//滑动触发div
    var circleRadius = window.innerWidth*560/750/2;//原型半径
    var circleX=window.innerWidth/2-circleRadius;//圆形X坐标
    var circleY=window.innerHeight/2-circleRadius;//圆形X坐标
    console.log(circleRadius,circleX,circleY);
    upload.onchange = function () {
        var file = upload.files[0];
        if (file.type !== 'image/jpeg' && file.type !== 'image/png' && file.type !== 'image/gif') {
            alert('不是有效的图片');
            console.log(file.type);
            return;
        }
        clipImg.src=window.URL.createObjectURL(upload.files[0]);
        clip.style.display="block";
        clipCoverImg.onload=function(){
            clipCoverImg.style.top=(window.innerHeight-clipCoverImg.height)/2+"px";
        }
        if(clipCoverImg.height){
            clipCoverImg.style.top=(window.innerHeight-clipCoverImg.height)/2+"px";
        }
    }

    clipCoverDiv.addEventListener('touchstart',touchGesture, false);//一个手指触摸
    clipCoverDiv.addEventListener('touchmove',touchGesture, false);//一个手指移动
    clipCoverDiv.addEventListener('touchend',touchGesture, false);//一个手指离开

    clipCoverDiv.addEventListener('gesturestart',touchGesture, false);//另一个手指触摸
    clipCoverDiv.addEventListener('gesturechange',touchGesture, false);//任何一个手指移动
    clipCoverDiv.addEventListener('gestureend',touchGesture, false);//任何一个手指离开

    var gdx,gdy,ydx,ydy;//定义原始x、y and 移动x、y
    var state;//定义执行进度
    function touchGesture(event){
        var event = event || window.event;
        document.getElementById('event').innerHTML=event.type;
        state=event.type;
        switch(event.type){
            case "touchstart":{
                gdx=event.touches[0].clientX;
                gdy=event.touches[0].clientY;
                break;
            }
            case "touchmove": {
                ydx=clipImg.offsetLeft-(gdx-event.changedTouches[0].clientX);
                ydy=clipImg.offsetTop-(gdy-event.changedTouches[0].clientY);
               
                if (clipImg.offsetLeft>circleX&&ydx>=clipImg.offsetLeft) {
                    ydx=circleX;
                }
                if(clipImg.width+clipImg.offsetLeft<circleX+circleRadius*2){
                    ydx=circleX+circleRadius*2;
                }
                clipImg.style.left = ydx + "px";
                gdx = event.changedTouches[0].clientX;

                if(clipImg.offsetTop>circleY&&ydy>=clipImg.offsetTop){
                    ydy=circleY;
                }
                clipImg.style.top = ydy + "px";
                gdy = event.changedTouches[0].clientY;
                break;
            }
            case "touchend":{
                break;
            }
        }
        event.preventDefault();
    }
</script>

</body>

</html>